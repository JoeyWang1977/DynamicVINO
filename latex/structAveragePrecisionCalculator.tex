\hypertarget{structAveragePrecisionCalculator}{}\section{Average\+Precision\+Calculator Struct Reference}
\label{structAveragePrecisionCalculator}\index{Average\+Precision\+Calculator@{Average\+Precision\+Calculator}}


{\ttfamily \#include $<$common.\+hpp$>$}

\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{structAveragePrecisionCalculator_ab552a6087e585fcdf5555c6fd05eb98c}{Average\+Precision\+Calculator} (double threshold)
\item 
void \hyperlink{structAveragePrecisionCalculator_a70ca18f1cff4c437ce60fffbb0559347}{consume\+Image} (const \hyperlink{classImageDescription}{Image\+Description} \&detected\+Objects, const \hyperlink{classImageDescription}{Image\+Description} \&desired\+Objects)
\item 
std\+::map$<$ \hyperlink{CMakeCache_8txt_a79a3d8790b2588b09777910863574e09}{int}, double $>$ \hyperlink{structAveragePrecisionCalculator_aebdc3e49c0ada0dc2168bff7ebc6df95}{calculate\+Average\+Precision\+Per\+Class} () const 
\end{DoxyCompactItemize}


\subsection{Detailed Description}


Definition at line 828 of file common.\+hpp.



\subsection{Constructor \& Destructor Documentation}
\index{Average\+Precision\+Calculator@{Average\+Precision\+Calculator}!Average\+Precision\+Calculator@{Average\+Precision\+Calculator}}
\index{Average\+Precision\+Calculator@{Average\+Precision\+Calculator}!Average\+Precision\+Calculator@{Average\+Precision\+Calculator}}
\subsubsection[{\texorpdfstring{Average\+Precision\+Calculator(double threshold)}{AveragePrecisionCalculator(double threshold)}}]{\setlength{\rightskip}{0pt plus 5cm}Average\+Precision\+Calculator\+::\+Average\+Precision\+Calculator (
\begin{DoxyParamCaption}
\item[{double}]{threshold}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}}\hypertarget{structAveragePrecisionCalculator_ab552a6087e585fcdf5555c6fd05eb98c}{}\label{structAveragePrecisionCalculator_ab552a6087e585fcdf5555c6fd05eb98c}


Definition at line 852 of file common.\+hpp.


\begin{DoxyCode}
852 : threshold(threshold) \{ \}
\end{DoxyCode}


\subsection{Member Function Documentation}
\index{Average\+Precision\+Calculator@{Average\+Precision\+Calculator}!calculate\+Average\+Precision\+Per\+Class@{calculate\+Average\+Precision\+Per\+Class}}
\index{calculate\+Average\+Precision\+Per\+Class@{calculate\+Average\+Precision\+Per\+Class}!Average\+Precision\+Calculator@{Average\+Precision\+Calculator}}
\subsubsection[{\texorpdfstring{calculate\+Average\+Precision\+Per\+Class() const }{calculateAveragePrecisionPerClass() const }}]{\setlength{\rightskip}{0pt plus 5cm}std\+::map$<${\bf int}, double$>$ Average\+Precision\+Calculator\+::calculate\+Average\+Precision\+Per\+Class (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
) const\hspace{0.3cm}{\ttfamily [inline]}}\hypertarget{structAveragePrecisionCalculator_aebdc3e49c0ada0dc2168bff7ebc6df95}{}\label{structAveragePrecisionCalculator_aebdc3e49c0ada0dc2168bff7ebc6df95}
Precision-\/to-\/\+TP curve per class (a variation of precision-\/to-\/recall curve without dividing into N)

Definition at line 908 of file common.\+hpp.


\begin{DoxyCode}
908                                                                   \{
912         std::map<int, std::map<int, double>> precisionToTP;
913 
914 
915         std::map<int, double> res;
916 
917         \textcolor{keywordtype}{double} AP = 0;
918         \textcolor{keywordtype}{double} q = 0;
919         \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} m : matches) \{
920             \textcolor{comment}{// Sorting}
921             std::sort(m.second.begin(), m.second.end(), SortPairDescend);
922 
923             \textcolor{keywordtype}{int} clazz = m.first;
924             \textcolor{keywordtype}{int} TP = 0, FP = 0;
925 
926             std::vector<double> prec;
927             std::vector<double> rec;
928 
929             \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} mm : m.second) \{
930                 \textcolor{comment}{// Here we are descending in a probability value}
931                 MatchKind mk = mm.second;
932                 \textcolor{keywordflow}{if} (mk == TruePositive) TP++;
933                 \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (mk == FalsePositive) FP++;
934 
935                 \textcolor{keywordtype}{double} precision = \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{double}\textcolor{keyword}{>}(TP) / (TP + FP);
936                 \textcolor{keywordtype}{double} recall = 0;
937                 \textcolor{keywordflow}{if} (N.find(clazz) != N.end()) \{
938                     recall = \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{double}\textcolor{keyword}{>}(TP) / N.at(clazz);
939                 \}
940 
941                 prec.push\_back(precision);
942                 rec.push\_back(recall);
943             \}
944 
945             \textcolor{keywordtype}{int} num = rec.size();
946 
947             \textcolor{comment}{// 11point from Caffe}
948             \textcolor{keywordtype}{double} ap = 0;
949             std::vector<float> max\_precs(11, 0.);
950             \textcolor{keywordtype}{int} start\_idx = num - 1;
951             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 10; j >= 0; --j) \{
952                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = start\_idx; i >= 0; --i) \{
953                     \textcolor{keywordflow}{if} (rec[i] < j / 10.) \{
954                         start\_idx = i;
955                         \textcolor{keywordflow}{if} (j > 0) \{
956                             max\_precs[j-1] = max\_precs[j];
957                         \}
958                         \textcolor{keywordflow}{break};
959                     \} \textcolor{keywordflow}{else} \{
960                         \textcolor{keywordflow}{if} (max\_precs[j] < prec[i]) \{
961                             max\_precs[j] = prec[i];
962                         \}
963                     \}
964                 \}
965             \}
966             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 10; j >= 0; --j) \{
967                 ap += max\_precs[j] / 11;
968             \}
969             res[clazz] = ap;
970         \}
971 
972         \textcolor{keywordflow}{return} res;
973     \}
\end{DoxyCode}
\index{Average\+Precision\+Calculator@{Average\+Precision\+Calculator}!consume\+Image@{consume\+Image}}
\index{consume\+Image@{consume\+Image}!Average\+Precision\+Calculator@{Average\+Precision\+Calculator}}
\subsubsection[{\texorpdfstring{consume\+Image(const Image\+Description \&detected\+Objects, const Image\+Description \&desired\+Objects)}{consumeImage(const ImageDescription &detectedObjects, const ImageDescription &desiredObjects)}}]{\setlength{\rightskip}{0pt plus 5cm}void Average\+Precision\+Calculator\+::consume\+Image (
\begin{DoxyParamCaption}
\item[{const {\bf Image\+Description} \&}]{detected\+Objects, }
\item[{const {\bf Image\+Description} \&}]{desired\+Objects}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}}\hypertarget{structAveragePrecisionCalculator_a70ca18f1cff4c437ce60fffbb0559347}{}\label{structAveragePrecisionCalculator_a70ca18f1cff4c437ce60fffbb0559347}


Definition at line 857 of file common.\+hpp.


\begin{DoxyCode}
857                                                                                                        \{
858             \textcolor{comment}{// Collecting IoU values}
859         \textcolor{keywordtype}{int} tp = 0, fp = 0;
860 
861         std::vector<bool> visited(desiredObjects.\hyperlink{classImageDescription_aa814580e2dd58fc3442ddd3549e6d81d}{alist}.size(), \textcolor{keyword}{false});
862         std::vector<DetectedObject> bboxes\{ std::begin(detectedObjects.\hyperlink{classImageDescription_aa814580e2dd58fc3442ddd3549e6d81d}{alist}), std::end(
      detectedObjects.\hyperlink{classImageDescription_aa814580e2dd58fc3442ddd3549e6d81d}{alist}) \};
863         std::sort(bboxes.begin(), bboxes.end(), SortBBoxDescend);
864 
865 
866         \textcolor{keywordflow}{for} (\textcolor{keyword}{auto}&& detObj : bboxes) \{
867                 \textcolor{comment}{// Searching for the best match to this detection}
868 
869             \textcolor{comment}{// Searching for desired object}
870             \textcolor{keywordtype}{float} overlap\_max = -1;
871             \textcolor{keywordtype}{int} jmax = -1;
872             \textcolor{keyword}{auto} desmax = desiredObjects.\hyperlink{classImageDescription_aa814580e2dd58fc3442ddd3549e6d81d}{alist}.end();
873 
874             \textcolor{keywordtype}{int} j = 0;
875             \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} desObj = desiredObjects.\hyperlink{classImageDescription_aa814580e2dd58fc3442ddd3549e6d81d}{alist}.begin(); desObj != desiredObjects.
      \hyperlink{classImageDescription_aa814580e2dd58fc3442ddd3549e6d81d}{alist}.end(); desObj++, j++) \{
876                 \textcolor{keywordtype}{double} iou = \hyperlink{classDetectedObject_abc68e001862990d52703deff97fe0db6}{DetectedObject::ioU}(detObj, *desObj);
877                 \textcolor{keywordflow}{if} (iou > overlap\_max) \{
878                     overlap\_max = iou;
879                     jmax = j;
880                     desmax = desObj;
881                 \}
882             \}
883 
884             MatchKind mk;
885             \textcolor{keywordflow}{if} (overlap\_max >= threshold) \{
886                 \textcolor{keywordflow}{if} (!desmax->difficult) \{
887                     \textcolor{keywordflow}{if} (!visited[jmax]) \{
888                         mk = TruePositive;
889                         visited[jmax] = \textcolor{keyword}{true};
890                     \} \textcolor{keywordflow}{else} \{
891                         mk = FalsePositive;
892                     \}
893                     matches[detObj.objectType].push\_back(std::make\_pair(detObj.prob, mk));
894                 \}
895             \} \textcolor{keywordflow}{else} \{
896                 mk = FalsePositive;
897                 matches[detObj.objectType].push\_back(std::make\_pair(detObj.prob, mk));
898             \}
899         \}
900 
901         \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} desObj = desiredObjects.\hyperlink{classImageDescription_aa814580e2dd58fc3442ddd3549e6d81d}{alist}.begin(); desObj != desiredObjects.
      \hyperlink{classImageDescription_aa814580e2dd58fc3442ddd3549e6d81d}{alist}.end(); desObj++) \{
902             \textcolor{keywordflow}{if} (!desObj->difficult) \{
903                 N[desObj->objectType]++;
904                 \}
905             \}
906         \}
\end{DoxyCode}


The documentation for this struct was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
include/openvino\+\_\+service/\hyperlink{common_8hpp}{common.\+hpp}\end{DoxyCompactItemize}
